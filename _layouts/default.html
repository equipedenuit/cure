<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>{{ page.title | default: site.title }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- FAVICONS -->
  <link rel="icon" href="{{ '/favicon.ico?v=4' | relative_url }}" sizes="any">
  <link rel="icon" type="image/png" sizes="32x32" href="{{ '/favicon-32.png?v=4' | relative_url }}">
  <link rel="icon" type="image/png" sizes="16x16" href="{{ '/favicon-16.png?v=4' | relative_url }}">
  <link rel="apple-touch-icon" sizes="180x180" href="{{ '/apple-touch-icon.png?v=4' | relative_url }}">
  <meta name="theme-color" content="#ffffff">

  <!-- Titre (Yuji Syuku) -->
  <link href="https://fonts.googleapis.com/css2?family=Yuji+Syuku&display=swap" rel="stylesheet">

  <style>
    /* Rendu proche Tumblr (colonne centrale) */
    body{
      font-family:"Times New Roman", serif;
      font-size:.88em;
      max-width:540px;
      margin:0 auto;
      padding:2rem 1rem;
      line-height:1.5;
      color:#111;
      background:#fff;
    }

    /* Logo / Titre de site */
    h1{font-size:2.2rem;font-weight:700;text-align:center;margin:0 0 .25rem 0;letter-spacing:.2px}
    h1 a{color:inherit;text-decoration:none;font-family:'Yuji Syuku',serif}
    h1 a:visited{color:inherit}
    .emdash{margin:0 0 0 -52px;padding:0 7px 0 0;line-height:1.5}

    .subtitle{ text-align:center;font-style:italic;opacity:.8;margin:0 0 1rem }

    /* Liens web 1.0 */
    a{color:#0000EE;text-decoration:underline}
    a:visited{color:#551A8B}

    /* Liste de catégories (style Tumblr, centrée, virgules) */
    .cats-wrapper{ text-align:center; margin:1em 0 }
    .cats-wrapper .cat-link{ font:inherit; font-size:1rem; color:#0000EE; text-decoration:none }
    .cats-wrapper .cat-link:hover{ text-decoration:underline }
    .cats-wrapper .sep{ margin:0 .25em }

    /* Articles */
    article{ margin:0 0 3rem }
    article h2{ font-size:1.25rem; margin:.25rem 0 }
    .meta{ font-size:11px; color:#9d9d9d; margin-bottom:.75rem }

    /* Contenu justifié */
    .post-content{ text-align:justify }

    /* Embeds responsives */
    iframe{ width:100%; max-width:100%; aspect-ratio:16/9; height:auto; display:block; margin:0 auto }
    img,video{ max-width:100%; height:auto; display:block; margin:0 auto }

    /* Fallback e-mail : caché côté web */
    @media screen { .email-preview{ display:none } }

    /* Formulaire d’abonnement */
    #subscribe{ width:100%; margin:1.5rem 0 2rem; padding:0; box-sizing:border-box }
    #subscribe form{ display:flex; align-items:center; justify-content:center; gap:.75rem; flex-wrap:nowrap }
    #subscribe .sub-label{ flex:0 0 auto; white-space:nowrap; margin:0; font:inherit }
    #subscribe input[type="email"], #subscribe button{
      box-sizing:border-box; -webkit-appearance:none; appearance:none; border-radius:0;
      font:inherit; line-height:1.2; min-height:44px;
    }
    #subscribe input[type="email"]{ flex:1 1 auto; min-width:0; padding:.5rem .75rem; border:1px solid #000; background:#fff; color:#000; font-size:16px }
    #subscribe button{ flex:0 0 auto; padding:.5rem 1rem; border:1px solid #000; background:#fff; color:#000; cursor:pointer; white-space:nowrap }
    #subscribe button:hover{ background:#000; color:#fff }
    #subscribe button:disabled{ background:#f5f5f5; color:#000; opacity:.6; cursor:not-allowed }
    @media (max-width:900px){
      #subscribe form{ flex-wrap:wrap }
      #subscribe .sub-label{ flex:1 1 100%; text-align:center; white-space:normal; margin-bottom:.5rem }
    }
    @media (max-width:520px){ #subscribe input[type="email"], #subscribe button{ width:100% } }

    /* Citations */
    blockquote{ margin:1.5rem 0; padding-left:1rem; border-left:3px solid #000; font-style:italic; color:#555; line-height:1.5 }
    blockquote footer{ margin-top:.5rem; font-style:normal; font-size:.9em; color:#333 }
    blockquote footer a{ color:#333; text-decoration:underline }
  </style>
</head>

<body>
  <!-- ENTÊTE -->
  <h1>
    <a href="{{ '/' | relative_url }}" title="Revenir à l’accueil">
      <span class="emdash">—</span> Cure
    </a>
  </h1>
  {% if site.description %}<div class="subtitle">{{ site.description }}</div>{% endif %}

  <!-- LISTE AUTOMATIQUE DES CATÉGORIES -->
  {% include categories_list.html %}

  <!-- FORMULAIRE ABONNEMENT -->
  <div id="subscribe">
    <form name="newsletter" method="POST" data-netlify="true" netlify-honeypot="bot-field" action="/confirmation/">
      <input type="hidden" name="form-name" value="newsletter">
      <p style="display:none;"><label>Ne pas remplir : <input name="bot-field"></label></p>

      <label for="email" class="sub-label">Recevoir les nouveaux posts par email</label>
      <input id="email" name="email" type="email" required placeholder="votre@email.com" aria-label="Adresse email">
      <button type="submit" aria-label="S’abonner">S’abonner</button>
    </form>
  </div>

  <!-- CONTENU : LISTE DES POSTS -->
  <main class="page-content" aria-label="Content">
    {% for post in site.posts %}
      <article>
        <h2 class="post-title">
          <a href="{{ post.url | relative_url }}">{{ post.title }}</a>
        </h2>
        <p class="meta">{{ post.date | date: "%d %B %Y" }}</p>

        {%- comment -%}
        Auto hero resolver pour l’index :
        - post.hero prioritaire
        - sinon miniature YouTube (post.youtube_id)
        - sinon première image trouvée dans le contenu (dans ce cas, on ne rajoute PAS d’image web pour éviter le doublon ; on laisse l’image du contenu)
        Toujours : générer un fallback e-mail cliquable (caché sur web).
        {%- endcomment -%}

        {%- assign hero_url = nil -%}
        {%- assign hero_source = nil -%}

        {%- if post.hero and post.hero != "" -%}
          {%- assign hero_url = post.hero -%}
          {%- assign hero_source = "front" -%}
        {%- elsif post.youtube_id and post.youtube_id != "" -%}
          {%- assign hero_url = "https://img.youtube.com/vi/" | append: post.youtube_id | append: "/hqdefault.jpg" -%}
          {%- assign hero_source = "youtube" -%}
        {%- else -%}
          {%- assign html = post.content | markdownify -%}
          {%- if html contains '<img' -%}
            {%- assign split1 = html | split:'<img' -%}
            {%- assign after_img = split1[1] -%}
            {%- assign split2 = after_img | split:'src="' -%}
            {%- if split2.size > 1 -%}
              {%- assign split3 = split2[1] | split:'"' -%}
              {%- assign hero_url = split3[0] -%}
              {%- assign hero_source = "firstimg" -%}
            {%- endif -%}
          {%- endif -%}
        {%- endif -%}

        {%- if hero_url -%}
          {%- if hero_url contains '://' -%}
            {%- assign hero_rel = hero_url -%}
            {%- assign hero_abs = hero_url -%}
          {%- else -%}
            {%- assign hero_rel = hero_url | relative_url -%}
            {%- assign hero_abs = hero_url | absolute_url -%}
          {%- endif -%}

          {%- if hero_source != "firstimg" -%}
            <!-- Web hero (pas de doublon si 1re image) -->
            <div class="hero" style="margin:1rem 0">
              <img src="{{ hero_rel }}" alt="{{ post.hero_alt | default: post.title }}">
            </div>
          {%- endif -%}

          <!-- Email fallback (toujours présent, mais caché sur web) -->
          <div class="email-preview" style="margin:1rem 0">
            <a href="{{ hero_abs }}">
              <img src="{{ hero_abs }}" alt="{{ post.hero_alt | default: post.title }}" style="max-width:100%;height:auto;border:0;">
            </a>
          </div>
        {%- endif -%}

        <div class="post-content">
          {{ post.content }}
        </div>
      </article>
    {% endfor %}
  </main>
</body>
</html>
